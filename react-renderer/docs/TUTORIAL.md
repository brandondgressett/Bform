# BFormDomain React Renderer Tutorial

## Table of Contents
1. [Introduction](#introduction)
2. [Getting Started](#getting-started)
3. [Basic Report Rendering](#basic-report-rendering)
4. [Enhanced Report Features](#enhanced-report-features)
5. [Working with HTML Entities](#working-with-html-entities)
6. [Interactive Charts](#interactive-charts)
7. [Table Data Extraction](#table-data-extraction)
8. [Plugin System](#plugin-system)
9. [Advanced Scenarios](#advanced-scenarios)
10. [Best Practices](#best-practices)

## Introduction

The BFormDomain React Renderer library provides powerful components for rendering HTML reports and content generated by the BFormDomain backend. This tutorial will walk you through all the capabilities, from basic rendering to advanced interactive features.

### Key Capabilities
- ðŸ”’ **Secure HTML Rendering** - Automatic sanitization of potentially dangerous content
- ðŸŽ¨ **Bootstrap Integration** - Automatic styling enhancement with Bootstrap classes
- ðŸ“Š **Interactive Charts** - Convert static HTML charts to interactive visualizations
- ðŸ“± **Responsive Design** - Mobile-friendly layouts out of the box
- ðŸ”Œ **Plugin Architecture** - Extensible system for custom entity renderers
- ðŸ“„ **Export & Print** - Built-in functionality for exporting and printing reports

## Getting Started

### Installation

```bash
npm install @bformdomain/react-renderer
```

### Basic Setup

```tsx
import React from 'react';
import { BFormDomainProvider } from '@bformdomain/react-renderer';

function App() {
  return (
    <BFormDomainProvider>
      {/* Your app content */}
    </BFormDomainProvider>
  );
}
```

## Basic Report Rendering

### Simple HTML Report Display

The most basic use case is rendering an HTML report from a `ReportInstance`:

```tsx
import { ReportRenderer } from '@bformdomain/react-renderer';

function MyReportView({ report }) {
  return (
    <ReportRenderer
      report={report}
      enhanceMode="minimal"
    />
  );
}
```

### Understanding Enhancement Modes

The `enhanceMode` prop controls how much the renderer modifies the original HTML:

#### 1. **"none"** - Raw HTML
```tsx
<ReportRenderer
  report={report}
  enhanceMode="none"  // No modifications, renders exactly as generated
/>
```

#### 2. **"minimal"** - Basic Enhancements
```tsx
<ReportRenderer
  report={report}
  enhanceMode="minimal"  // Adds Bootstrap classes, modernizes attributes
/>
```

#### 3. **"full"** - Interactive Features
```tsx
<ReportRenderer
  report={report}
  enhanceMode="full"  // Collapsible sections, table extraction, full interactivity
/>
```

## Enhanced Report Features

### Collapsible Sections

In full enhancement mode, report sections become collapsible:

```tsx
<ReportRenderer
  report={report}
  enhanceMode="full"
  onSectionToggle={(sectionIndex, isExpanded) => {
    console.log(`Section ${sectionIndex} is now ${isExpanded ? 'expanded' : 'collapsed'}`);
  }}
/>
```

### Table Data Extraction

Enable table extraction to convert HTML tables to structured data:

```tsx
<ReportRenderer
  report={report}
  enhanceMode="full"
  enableTableInteractivity={true}
  onTableDataExtracted={(tableData) => {
    console.log('Headers:', tableData.headers);
    console.log('Rows:', tableData.rows);
    console.log('Has totals:', tableData.hasTotal);
  }}
/>
```

### Modal Viewer with Full Features

The `ReportViewerModal` provides a complete viewing experience:

```tsx
import { ReportViewerModal } from '@bformdomain/react-renderer';

function ReportManager() {
  const [showModal, setShowModal] = useState(false);
  const [selectedReport, setSelectedReport] = useState(null);

  const viewReport = (report) => {
    setSelectedReport(report);
    setShowModal(true);
  };

  return (
    <>
      <button onClick={() => viewReport(myReport)}>
        View Report
      </button>
      
      {selectedReport && (
        <ReportViewerModal
          report={selectedReport}
          isOpen={showModal}
          onClose={() => setShowModal(false)}
          enableEnhancements={true}
        />
      )}
    </>
  );
}
```

The modal includes:
- Toggle between HTML and Table views
- Print functionality
- Export to HTML file
- AG-Grid integration for tabular data

## Working with HTML Entities

### Basic HTML Content Rendering

For generic HTML content (not reports), use `HtmlEntityRenderer`:

```tsx
import { HtmlEntityRenderer } from '@bformdomain/react-renderer';

function ContentDisplay({ htmlEntity }) {
  return (
    <HtmlEntityRenderer
      entity={htmlEntity}
      enableBootstrapClasses={true}
      allowUnsafeContent={false}  // Default is false for security
    />
  );
}
```

### Handling Draft vs Published Content

The renderer automatically styles draft content:

```tsx
// Draft content gets a yellow border indicator
const draftEntity = {
  ...entity,
  isPublished: false
};

<HtmlEntityRenderer entity={draftEntity} />
```

### Content Click Handling

Add interactivity to HTML content:

```tsx
<HtmlEntityRenderer
  entity={htmlEntity}
  onContentClick={(event) => {
    const target = event.target;
    if (target.tagName === 'A') {
      event.preventDefault();
      // Handle link clicks
      handleLinkClick(target.href);
    }
  }}
/>
```

## Interactive Charts

### Converting HTML Charts to React Components

The `EnhancedChart` component transforms static HTML bar charts into interactive visualizations:

```tsx
import { EnhancedChart } from '@bformdomain/react-renderer';

function ChartView({ reportHtml }) {
  return (
    <EnhancedChart
      htmlChartContent={reportHtml}
      chartType="bar"
      interactive={true}
      onSegmentClick={(data) => {
        console.log(`Clicked: ${data.label}`);
        console.log(`Value: ${data.value}`);
        console.log(`Percentage: ${data.percentage}%`);
      }}
    />
  );
}
```

### Chart Types

#### Bar Chart (Default)
```tsx
<EnhancedChart
  htmlChartContent={reportHtml}
  chartType="bar"
  interactive={true}
/>
```

#### Pie Chart
```tsx
<EnhancedChart
  htmlChartContent={reportHtml}
  chartType="pie"
  showLegend={true}
  interactive={true}
/>
```

#### Donut Chart
```tsx
<EnhancedChart
  htmlChartContent={reportHtml}
  chartType="donut"
  showLegend={true}
  interactive={true}
/>
```

## Table Data Extraction

### Extracting and Using Table Data

Convert HTML tables to structured data for use with AG-Grid or other components:

```tsx
import { extractTableData } from '@bformdomain/react-renderer';
import { AgGridReact } from '@ag-grid-community/react';

function InteractiveTable({ htmlContent }) {
  const [gridData, setGridData] = useState(null);

  useEffect(() => {
    const tableData = extractTableData(htmlContent);
    if (tableData) {
      setGridData(tableData);
    }
  }, [htmlContent]);

  if (!gridData) return null;

  const columnDefs = gridData.headers.map(header => ({
    field: header,
    headerName: header,
    sortable: true,
    filter: true
  }));

  return (
    <div style={{ height: 400 }}>
      <AgGridReact
        rowData={gridData.rows}
        columnDefs={columnDefs}
        pagination={true}
        paginationPageSize={20}
      />
      
      {gridData.hasTotal && gridData.totalRow && (
        <div className="totals-row mt-3">
          <h5>Totals</h5>
          {Object.entries(gridData.totalRow).map(([key, value]) => (
            <span key={key} className="me-3">
              <strong>{key}:</strong> {value}
            </span>
          ))}
        </div>
      )}
    </div>
  );
}
```

## Plugin System

### Using the Universal EntityRenderer

The `EntityRenderer` component automatically selects the appropriate renderer based on entity type:

```tsx
import { EntityRenderer } from '@bformdomain/react-renderer';

function UniversalViewer({ entity }) {
  return (
    <EntityRenderer
      entity={entity}
      // entityType is auto-detected from entity.entityType
      renderer="enhanced-report"  // Optional: specify renderer variant
      onClick={(entity) => console.log('Clicked:', entity)}
      onEdit={(entity) => handleEdit(entity)}
      onDelete={(entity) => handleDelete(entity)}
    />
  );
}
```

### Creating Custom Renderer Plugins

Extend the system with your own renderers:

```typescript
import { RendererPlugin, rendererRegistry } from '@bformdomain/react-renderer';

class CustomEntityRenderer implements RendererPlugin {
  id = 'custom-renderer';
  name = 'Custom Entity Renderer';
  version = '1.0.0';
  supportedEntityTypes = ['CustomEntity'];
  
  canRender(entityType, renderer) {
    return entityType === 'CustomEntity';
  }
  
  render(props) {
    return <MyCustomComponent {...props} />;
  }
}

// Register the plugin
rendererRegistry.register(new CustomEntityRenderer());
```

## Advanced Scenarios

### Custom Sanitization Options

Override default HTML sanitization settings:

```tsx
import { sanitizeReportHtml } from '@bformdomain/react-renderer';

const customSanitized = sanitizeReportHtml(htmlContent, {
  allowedTags: [...DEFAULT_ALLOWED_TAGS, 'custom-tag'],
  allowedAttributes: {
    ...DEFAULT_ALLOWED_ATTRIBUTES,
    'custom-tag': ['data-value']
  },
  allowedStyles: [...DEFAULT_ALLOWED_STYLES, 'custom-property']
});
```

### Styling and Theming

Add custom styles to reports:

```tsx
function StyledReport({ report }) {
  return (
    <>
      <style>{`
        .bf-report-enhanced {
          --report-primary-color: #007bff;
          --report-section-bg: #f8f9fa;
        }
        
        .bf-report-enhanced .SectionHeader {
          background-color: var(--report-section-bg);
          color: var(--report-primary-color);
        }
      `}</style>
      
      <ReportRenderer
        report={report}
        enhanceMode="full"
        className="custom-themed-report"
      />
    </>
  );
}
```

### Print-Specific Styling

The modal viewer handles printing, but you can add custom print styles:

```css
@media print {
  .bf-report-enhanced {
    font-size: 10pt;
  }
  
  .no-print {
    display: none !important;
  }
  
  .page-break {
    page-break-after: always;
  }
}
```

### Performance Optimization

For large reports, use React.memo and lazy loading:

```tsx
import React, { lazy, Suspense, memo } from 'react';

const ReportRenderer = lazy(() => 
  import('@bformdomain/react-renderer').then(module => ({
    default: module.ReportRenderer
  }))
);

const MemoizedReport = memo(({ report }) => (
  <Suspense fallback={<div>Loading report...</div>}>
    <ReportRenderer report={report} enhanceMode="minimal" />
  </Suspense>
));
```

## Best Practices

### 1. Security First
- Always use the default sanitization unless you explicitly trust the content
- Never set `allowUnsafeContent={true}` for user-generated content
- Review any custom sanitization rules carefully

### 2. Progressive Enhancement
- Start with minimal enhancement mode
- Only use full enhancement when interactivity is needed
- Consider performance impact on large reports

### 3. Accessibility
- Ensure proper heading hierarchy in HTML content
- Add alt text to images in HTML
- Test keyboard navigation for interactive features

### 4. Error Handling
```tsx
function SafeReportViewer({ report }) {
  if (!report || !report.html) {
    return <div>No report data available</div>;
  }
  
  try {
    return <ReportRenderer report={report} enhanceMode="minimal" />;
  } catch (error) {
    console.error('Report rendering error:', error);
    return <div>Error rendering report. Please try again.</div>;
  }
}
```

### 5. Responsive Design
The components are responsive by default, but you can enhance mobile experience:

```tsx
<div className="report-container">
  <ReportRenderer
    report={report}
    enhanceMode="full"
    className="mobile-optimized"
  />
</div>

<style>{`
  @media (max-width: 768px) {
    .mobile-optimized table {
      font-size: 0.875rem;
    }
    
    .mobile-optimized .bf-report-section-header {
      padding: 0.5rem;
    }
  }
`}</style>
```

## Conclusion

The BFormDomain React Renderer provides a comprehensive solution for rendering HTML reports and content with modern React features. From basic display to full interactivity with charts and tables, the library offers flexibility while maintaining security and performance.

### Next Steps
- Explore the [API Reference](./API-REFERENCE.md) for detailed component documentation
- Check out the [Examples](../examples/) directory for more code samples
- Review the [Architecture Guide](./REPORT-RENDERING.md) for technical details
- Join our community for support and feature requests

Happy rendering! ðŸš€